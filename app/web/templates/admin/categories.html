{% extends "base.html" %}

{% block title %}Manage Categories - Opinator Admin{% endblock %}

{% block content %}
<div class="max-w-6xl mx-auto">
    <!-- Header -->
    <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
        <div class="flex justify-between items-center">
            <div>
                <h2 class="text-2xl font-bold text-gray-800">
                    <i class="fas fa-tags mr-2 text-blue-600"></i>
                    Keyword Categories
                </h2>
                <p class="text-gray-600 mt-2">
                    Manage categories like "Parking", "Cleanliness", "Location", etc.
                </p>
            </div>
            <div class="flex space-x-3">
                <a href="/admin" class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg transition">
                    <i class="fas fa-arrow-left mr-2"></i>
                    Back to Admin
                </a>
                <button id="addCategoryBtn" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition">
                    <i class="fas fa-plus mr-2"></i>
                    Add Category
                </button>
            </div>
        </div>
    </div>

    <!-- Categories List -->
    <div class="bg-white rounded-lg shadow-lg">
        <div class="bg-gray-50 px-6 py-4 border-b">
            <h3 class="text-xl font-semibold text-gray-800">
                <i class="fas fa-list mr-2"></i>
                Categories ({{ categories|length }})
            </h3>
        </div>

        {% if categories %}
        <div class="p-6">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                {% for category in categories %}
                <div class="border border-gray-200 rounded-lg p-4 hover:shadow-lg transition">
                    <div class="flex items-center justify-between mb-3">
                        <div class="flex items-center">
                            <div class="p-2 rounded-lg mr-3" style="background-color: {{ category.color }}20;">
                                <i class="{{ category.icon }} text-lg" style="color: {{ category.color }};"></i>
                            </div>
                            <div>
                                <h4 class="font-semibold text-gray-800">{{ category.category_en }}</h4>
                                <span class="text-xs text-gray-500 font-mono">{{ category.category_key }}</span>
                            </div>
                        </div>
                        <div class="flex space-x-1">
                            <button class="text-blue-600 hover:text-blue-800 p-1"
                                    onclick="editCategory('{{ category.category_key }}')"
                                    title="Edit category">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="text-red-600 hover:text-red-800 p-1"
                                    onclick="deleteCategory('{{ category.category_key }}')"
                                    title="Delete category">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>

                    <div class="text-sm text-gray-600 mb-3">
                        {% if category.description %}
                            <p>{{ category.description }}</p>
                        {% endif %}
                    </div>

                    <div class="grid grid-cols-3 gap-2 text-sm">
                        <div class="text-center">
                            <span class="flag-icon flag-icon-us"></span>
                            <div class="font-medium">{{ category.category_en or 'N/A' }}</div>
                        </div>
                        <div class="text-center">
                            <span class="flag-icon flag-icon-es"></span>
                            <div class="font-medium">{{ category.category_es or 'N/A' }}</div>
                        </div>
                        <div class="text-center">
                            <span class="flag-icon flag-icon-fr"></span>
                            <div class="font-medium">{{ category.category_fr or 'N/A' }}</div>
                        </div>
                    </div>

                    <div class="mt-3 pt-3 border-t border-gray-100">
                        <div class="flex justify-between items-center">
                            <span class="text-xs text-gray-500">
                                {% if category.active %}
                                    <i class="fas fa-check-circle text-green-600 mr-1"></i>
                                    Active
                                {% else %}
                                    <i class="fas fa-times-circle text-red-600 mr-1"></i>
                                    Inactive
                                {% endif %}
                            </span>
                            <a href="/admin/keywords?category_key={{ category.category_key }}"
                               class="text-blue-600 hover:text-blue-800 text-sm font-medium">
                                <i class="fas fa-key mr-1"></i>
                                Manage Keywords
                            </a>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        {% else %}
        <div class="p-8 text-center">
            <div class="text-gray-400 mb-4">
                <i class="fas fa-tags text-4xl"></i>
            </div>
            <p class="text-gray-600 mb-4">No categories found</p>
            <button id="addFirstCategoryBtn" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg transition">
                <i class="fas fa-plus mr-2"></i>
                Add Your First Category
            </button>
        </div>
        {% endif %}
    </div>
</div>

<!-- Add/Edit Category Modal -->
<div id="categoryModal" class="fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center hidden z-50">
    <div class="bg-white rounded-lg shadow-2xl max-w-md w-full mx-4">
        <div class="bg-blue-600 text-white px-6 py-4 rounded-t-lg">
            <h3 id="modalTitle" class="text-lg font-semibold">
                <i class="fas fa-plus mr-2"></i>
                Add Category
            </h3>
        </div>
        <form id="categoryForm" class="p-6">
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Category Key *</label>
                    <input type="text" id="categoryKey"
                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                           placeholder="parking" required>
                    <p class="text-xs text-gray-500 mt-1">Unique identifier (lowercase, no spaces)</p>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">English Name *</label>
                    <input type="text" id="categoryEn"
                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                           placeholder="Parking" required>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Spanish Name</label>
                    <input type="text" id="categoryEs"
                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                           placeholder="Aparcamiento">
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">French Name</label>
                    <input type="text" id="categoryFr"
                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                           placeholder="Parking">
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Icon</label>
                        <input type="text" id="categoryIcon"
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                               placeholder="fas fa-parking" value="fas fa-tag">
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Color</label>
                        <input type="color" id="categoryColor"
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                               value="#6B7280">
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Description</label>
                    <textarea id="categoryDescription" rows="3"
                              class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                              placeholder="Description of this category..."></textarea>
                </div>
            </div>

            <div class="flex justify-end space-x-3 mt-6">
                <button type="button" id="cancelBtn" class="px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50 transition">
                    Cancel
                </button>
                <button type="submit" class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition">
                    <i class="fas fa-save mr-2"></i>
                    Save Category
                </button>
            </div>
        </form>
    </div>
</div>

<script>
// Modal management
const modal = document.getElementById('categoryModal');
const addCategoryBtn = document.getElementById('addCategoryBtn');
const addFirstCategoryBtn = document.getElementById('addFirstCategoryBtn');
const cancelBtn = document.getElementById('cancelBtn');
const categoryForm = document.getElementById('categoryForm');
const modalTitle = document.getElementById('modalTitle');

let isEditing = false;
let editingKey = null;

function showModal() {
    modal.classList.remove('hidden');
}

function hideModal() {
    modal.classList.add('hidden');
    categoryForm.reset();
    isEditing = false;
    editingKey = null;
    modalTitle.innerHTML = '<i class="fas fa-plus mr-2"></i>Add Category';
}

// Event listeners
addCategoryBtn?.addEventListener('click', showModal);
addFirstCategoryBtn?.addEventListener('click', showModal);
cancelBtn.addEventListener('click', hideModal);

// Close modal when clicking outside
modal.addEventListener('click', function(e) {
    if (e.target === modal) {
        hideModal();
    }
});

// Edit category
function editCategory(categoryKey) {
    // This would be populated with actual category data
    isEditing = true;
    editingKey = categoryKey;
    modalTitle.innerHTML = '<i class="fas fa-edit mr-2"></i>Edit Category';
    showModal();

    // TODO: Load category data and populate form
    console.log('Editing category:', categoryKey);
}

// Delete category
function deleteCategory(categoryKey) {
    if (confirm('Are you sure you want to delete this category and all its keywords?')) {
        // TODO: Implement delete functionality
        console.log('Deleting category:', categoryKey);
    }
}

// Form submission
categoryForm.addEventListener('submit', function(e) {
    e.preventDefault();

    const formData = {
        category_key: document.getElementById('categoryKey').value,
        category_en: document.getElementById('categoryEn').value,
        category_es: document.getElementById('categoryEs').value || null,
        category_fr: document.getElementById('categoryFr').value || null,
        icon: document.getElementById('categoryIcon').value || 'fas fa-tag',
        color: document.getElementById('categoryColor').value || '#6B7280',
        description: document.getElementById('categoryDescription').value || null
    };

    console.log('Form data:', formData);

    // TODO: Submit to API endpoint
    if (isEditing) {
        console.log('Updating category:', editingKey, formData);
        // PUT /admin/api/categories/{categoryKey}
    } else {
        console.log('Creating category:', formData);
        // POST /admin/api/categories
    }

    hideModal();
});
</script>

<style>
.flag-icon {
    width: 16px;
    height: 12px;
    display: inline-block;
    margin-bottom: 2px;
}
.flag-icon-us::before { content: "🇺🇸"; }
.flag-icon-es::before { content: "🇪🇸"; }
.flag-icon-fr::before { content: "🇫🇷"; }
</style>
{% endblock %}